{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Credit Limit Update</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eff6ff',
              100: '#dbeafe',
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
            },
            secondary: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
            },
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          boxShadow: {
            'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out forwards',
            'slide-up': 'slideUp 0.5s ease-out forwards',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
          },
        },
      },
    }
  </script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .card-hover {
      transition: all 0.3s ease;
    }

    .card-hover:hover {
      transform: translateY(-5px);
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }

    .animate-pulse-slow {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    .animate-delay-1 { animation-delay: 0.4s; }
    .animate-delay-2 { animation-delay: 0.5s; }
    .animate-delay-3 { animation-delay: 0.6s; }
    .animate-delay-100 { animation-delay: 0.1s; }
    .animate-delay-200 { animation-delay: 0.2s; }
    .animate-delay-300 { animation-delay: 0.3s; }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    /* Input focus effect */
    .focus-ring {
      transition: all 0.2s ease;
    }

    .focus-ring:focus {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-secondary-50 to-secondary-100 min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <!-- Header Section -->
    <div class="mb-8 text-center animate-fade-in">
      <div class="inline-block p-1 bg-gradient-to-r from-primary-500 to-primary-700 rounded-full mb-3">
        <div class="bg-white p-2 rounded-full">
          <i class="fas fa-credit-card text-primary-600 text-xl"></i>
        </div>

      </div>
      <h1 class="text-3xl font-bold text-secondary-800 mb-2">Customer Terms & Limits</h1>
      <p class="text-secondary-500 max-w-2xl mx-auto">Update credit limits and payment terms for your customers</p>

    </div>

    <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
      <a href="{% url 'md_dashboard' %}"
   class="mt-2 sm:mt-0 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
  <i class="fas fa-arrow-left mr-2"></i> Back to Dashbaord
</a>
    </header>
    <!-- Breadcrumb Navigation -->





    <!-- Stats Overview -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 animate-fade-in animate-delay-100">
      <div class="bg-white rounded-xl shadow-card p-4 border border-secondary-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-secondary-500 font-medium">Total Customers</p>
            <p class="text-2xl font-bold text-secondary-800">{{ customer_forms|length }}</p>
          </div>
          <div class="bg-primary-100 p-3 rounded-lg">
            <i class="fas fa-users text-primary-600"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-card p-4 border border-secondary-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-secondary-500 font-medium">Change the Terms or Limit</p>
            <p class="text-2xl font-bold text-secondary-800">

            </p>
          </div>
          <div class="bg-green-100 p-3 rounded-lg">
            <i class="fas fa-calendar-alt text-green-600"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-card p-4 border border-secondary-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-secondary-500 font-medium">Last Updated</p>
            <p class="text-2xl font-bold text-secondary-800">Today</p>
          </div>
          <div class="bg-purple-100 p-3 rounded-lg">
            <i class="fas fa-clock text-purple-600"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Box -->
<div class="mb-6 animate-fade-in animate-delay-200">
  <div class="relative">
    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
      <i class="fas fa-search text-secondary-400"></i>
    </div>
    <input
      type="text"
      id="searchInput"
      placeholder="Search customers by name..."
      class="w-full border border-secondary-200 rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all focus-ring"
      onkeyup="filterCustomers()"
    >
  </div>
  <div id="searchStats" class="text-sm text-secondary-500 mt-2 pl-1">
    Showing all {{ customer_forms|length }} customers
  </div>
  FIRST EXPORT THE FILE THEN UPLOAD IT
  <!-- Export and Upload Buttons -->
  <div class="mt-4 flex justify-between">
    <!-- Export Button -->
    <a href="{% url 'export_customer_names' %}"
       class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
      <i class="fas fa-file-export mr-2"></i> Export
    </a>

    <!-- Upload Button -->
    <a href="{% url 'upload_customer_limits' %}"
       class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
      <i class="fas fa-upload mr-2"></i> Upload
    </a>
  </div>
</div>
<!-- Customer Cards -->
<div id="customerGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 animate-fade-in animate-delay-300">
    {% for customer, form in customer_forms %}
    <div class="bg-white rounded-xl shadow-card p-5 border border-secondary-100 hover:shadow-card-hover transition-all customer-card card-hover"
         data-name="{{ customer.name|lower }}"
         style="animation-delay: 40ms;">
      <div class="flex justify-between items-start mb-3">
        <h3 class="text-lg font-semibold text-secondary-800">{{ customer.name }}</h3>
        <span class="bg-primary-100 text-primary-700 text-xs font-medium px-2.5 py-1 rounded-full">
          ID: {{ customer.id }}
        </span>
      </div>

      <div class="flex items-center mb-4 p-3 bg-secondary-50 rounded-lg">
        <div class="mr-3 bg-primary-100 p-2 rounded-full">
          <i class="fas fa-calendar-day text-primary-600"></i>
        </div>
        <div>
          <p class="text-xs text-secondary-500">Current Payment Term</p>
          <p class="text-lg font-bold text-secondary-800">{{ customer.credit_limit }} days</p>
          <p class="text-xs text-secondary-500">Current Credit Limit</p>
          <p class="text-lg font-bold text-secondary-800">{{ customer.credit_limit_amount }} AED</p>
          <p class="text-xs text-secondary-500">Opening Balance</p>
          <p class="text-lg font-bold text-secondary-800">{{ customer.opening_balance }} AED</p>
        </div>
      </div>

        <form method="post" class="space-y-4">
          {% csrf_token %}
          <div>
            <label class="block text-sm font-medium text-secondary-700 mb-1.5">New Payment Term</label>
            <div class="relative">
              {% render_field form.credit_limit class="w-full border border-secondary-200 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all focus-ring" %}
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <span class="text-secondary-500 text-sm">days</span>
              </div>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-secondary-700 mb-1.5">New Credit Limit Amount</label>
            <div class="relative">
              {% render_field form.credit_limit_amount class="w-full border border-secondary-200 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all focus-ring" %}
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <span class="text-secondary-500 text-sm">AED</span>
              </div>
            </div>
          </div>
          <input type="hidden" name="customer_id" value="{{ customer.id }}">
          <button type="submit" class="w-full bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-medium py-2.5 px-4 rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
            <i class="fas fa-save mr-2"></i>Update Limit
          </button>
        </form>
      </div>
      {% empty %}
      <div class="col-span-3 bg-white rounded-xl shadow-card p-8 text-center border border-secondary-100">
        <div class="flex flex-col items-center">
          <div class="bg-secondary-100 p-4 rounded-full mb-4">
            <i class="fas fa-users text-3xl text-secondary-400"></i>
          </div>
          <h3 class="text-lg font-medium text-secondary-800 mb-1">No Customers Found</h3>
          <p class="text-secondary-500 text-sm">There are no customers in the system yet.</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- JavaScript to Filter Customer Cards -->
  <script>
    function filterCustomers() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const cards = document.querySelectorAll('.customer-card');
      let visibleCount = 0;

      cards.forEach(card => {
        const name = card.getAttribute('data-name');
        if (name.includes(search)) {
          card.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      // Update search stats
      const statsElement = document.getElementById('searchStats');
      if (search === '') {
        statsElement.textContent = `Showing all ${cards.length} customers`;
      } else {
        statsElement.textContent = `Found ${visibleCount} customer${visibleCount !== 1 ? 's' : ''} matching "${search}"`;
      }
    }

    // Add staggered animation to cards
    document.addEventListener('DOMContentLoaded', function() {
      const cards = document.querySelectorAll('.customer-card');
      cards.forEach((card, index) => {
        setTimeout(() => {
          card.classList.add('animate-slide-up');
        }, 100 + (index * 50));
      });
    });
  </script>
</body>
</html>